<div id="action-panel" class="{% if not is_player_turn %}panel-disabled{% endif %}" {% if not is_player_turn %}style="opacity: 0.5; pointer-events: none;"{% endif %}>

    <div class="flex-between" style="margin-bottom: 12px;">
        <span class="section-label">Actions</span>
        {% if is_player_turn %}<span class="badge badge-green">Your Turn</span>{% endif %}
    </div>

    {% if concentration %}
        <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; border: 1px solid rgba(155, 89, 182, 0.3); border-radius: var(--radius); margin-bottom: 12px; font-size: 12px;">
            <span class="text-muted">Concentrating: <span style="color: var(--text);">{{ concentration.spell.name }}</span></span>
            {% if can_break_concentration %}
                <button type="button"
                        class="btn btn-ghost" style="font-size: 11px; padding: 3px 8px;"
                        hx-post="{% url 'character-break-concentration' concentration.character.pk %}"
                        hx-target="#action-panel"
                        hx-swap="outerHTML">Drop</button>
            {% endif %}
        </div>
    {% endif %}

    <!-- Action row -->
    <div style="display: flex; align-items: flex-start; gap: 8px; padding: 8px 0; border-bottom: 1px solid var(--border);">
        <span style="font-size: 12px; color: var(--text-muted); width: 80px; flex-shrink: 0; padding-top: 7px;">
            Action {% if turn.action_used %}<span class="status-used text-muted" style="text-decoration: line-through; font-size: 10px;">used</span>{% endif %}
        </span>
        <div style="display: flex; gap: 6px; flex-wrap: wrap;">
            {% for action in standard_actions %}
                {% if action.value == 'attack' %}
                    <button class="btn {% if turn.action_used %}disabled btn-ghost{% else %}btn-ghost{% endif %}"
                            {% if not turn.action_used and is_player_turn %}
                                hx-get="{% url 'combat-attack-modal' game.id combat.id %}"
                                hx-target="body"
                                hx-swap="beforeend"
                            {% else %}
                                disabled
                            {% endif %}>{{ action.label }}</button>
                {% else %}
                    <button class="btn {% if turn.action_used %}disabled btn-ghost{% else %}btn-ghost{% endif %}"
                            {% if not turn.action_used and is_player_turn %}
                                hx-post="{% url 'combat-take-action' game.id combat.id %}"
                                hx-vals='{"action": "{{ action.value }}", "action_type": "A"}'
                                hx-target="#action-panel"
                                hx-swap="outerHTML"
                            {% else %}
                                disabled
                            {% endif %}>{{ action.label }}</button>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Bonus action row -->
    <div style="display: flex; align-items: center; gap: 8px; padding: 8px 0; border-bottom: 1px solid var(--border);">
        <span style="font-size: 12px; color: var(--text-muted); width: 80px; flex-shrink: 0;">Bonus Action</span>
        <span style="font-size: 12px; color: {% if turn.bonus_action_used %}var(--text-muted){% else %}var(--text){% endif %};">
            {% if turn.bonus_action_used %}spent{% else %}available{% endif %}
        </span>
    </div>

    <!-- Reaction row -->
    <div style="display: flex; align-items: center; gap: 8px; padding: 8px 0; border-bottom: 1px solid var(--border);">
        <span style="font-size: 12px; color: var(--text-muted); width: 80px; flex-shrink: 0;">Reaction</span>
        <span style="font-size: 12px; color: {% if turn.reaction_used %}var(--text-muted){% else %}var(--text){% endif %};">
            {% if turn.reaction_used %}spent{% else %}available{% endif %}
        </span>
    </div>

    <!-- Movement row -->
    <div style="display: flex; align-items: center; gap: 8px; padding: 8px 0;">
        <span style="font-size: 12px; color: var(--text-muted); width: 80px; flex-shrink: 0;">Movement</span>
        <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                <div class="hp-bar" style="flex: 1; max-width: 120px;">
                    <div class="hp-bar-fill" style="background: var(--blue); width: {% widthratio turn.remaining_movement turn.movement_total 100 %}%;"></div>
                </div>
                <span style="font-size: 12px; color: var(--text-muted);">{{ turn.remaining_movement }}/{{ turn.movement_total }} ft</span>
            </div>
            {% if is_player_turn and turn.remaining_movement > 0 %}
                <div style="display: flex; gap: 4px;">
                    <button class="btn btn-ghost" style="font-size: 11px; padding: 3px 8px;"
                            hx-post="{% url 'combat-move' game.id combat.id %}"
                            hx-vals='{"feet": "5"}'
                            hx-target="#action-panel"
                            hx-swap="outerHTML">5 ft</button>
                    <button class="btn btn-ghost" style="font-size: 11px; padding: 3px 8px;"
                            hx-post="{% url 'combat-move' game.id combat.id %}"
                            hx-vals='{"feet": "10"}'
                            hx-target="#action-panel"
                            hx-swap="outerHTML">10 ft</button>
                    <button class="btn btn-ghost" style="font-size: 11px; padding: 3px 8px;"
                            hx-post="{% url 'combat-move' game.id combat.id %}"
                            hx-vals='{"feet": "{{ turn.remaining_movement }}"}'
                            hx-target="#action-panel"
                            hx-swap="outerHTML">All</button>
                </div>
            {% endif %}
        </div>
    </div>

    {% if actions_taken %}
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
            <span class="section-label" style="display: block; margin-bottom: 8px;">Actions Taken</span>
            {% for action in actions_taken %}
                <div style="font-size: 12px; color: var(--text-muted); padding: 3px 0;">
                    <span class="badge badge-muted" style="font-size: 10px;">{{ action.get_action_type_display }}</span>
                    {{ action.get_action_display }}
                    {% if action.target_fighter %} â†’ {{ action.target_fighter }}{% endif %}
                </div>
            {% endfor %}
        </div>
    {% endif %}

</div>
