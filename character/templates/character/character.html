{% extends 'base.html' %}

{% block content %}
    <div class="rpg-container">
        <div class="rpg-panel">
            <h1 class="panel-title" style="font-size: 2rem;">‚öîÔ∏è {{ character }}</h1>
            <div class="text-center mb-2">
                <a href="{% url 'index' %}" style="color: var(--color-primary); text-decoration: underline;">Return to main menu</a>
            </div>

            <table id="characteristics" class="rpg-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Race</th>
                        <th>Class</th>
                        <th>Alignment</th>
                        <th>Level</th>
                        <th>XP</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ character.user.username }}</td>
                        <td>{{ character.get_race_display }}</td>
                        <td>{{ character.get_klass_display }}</td>
                        <td>{{ character.get_alignment_display }}</td>
                        <td>{{ character.level }}</td>
                        <td>{{ character.xp }}</td>
                    </tr>
                </tbody>
            </table>

            <div class="rpg-section">
                <table id="main">
                    <tr>
                        <td id="hp">
                            <div class="stat-bar">
                                <div class="stat-label">
                                    <span class="stat-label-name">HP</span>
                                    <span>{{ character.hp }} / {{ character.max_hp }}</span>
                                </div>
                                <div class="stat-progress">
                                    <div class="stat-fill health" style="width: {% widthratio character.hp character.max_hp 100 %}%"></div>
                                </div>
                            </div>
                        </td>
                        <td id="abilities">
                            <table class="rpg-table">
                                <tr><th colspan="3"><h3>Abilities</h3></th></tr>
                                {% for ability in abilities %}
                                    <tr>
                                        <th>{{ ability }}:</th>
                                        <td>{{ ability.score }}</td>
                                        <td>({{ ability.modifier }})</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </td>
                        <td id="other-abilities">
                            <table id="proficiency-bonus" class="rpg-table">
                                <tr>
                                    <td>Proficiency bonus: {{ character.proficiency_bonus }}</td>
                                </tr>
                            </table>
                            <table id="skills" class="rpg-table">
                                <tr><th><h3>Skills</h3></th></tr>
                                {% for skill in character.skills.all %}
                                    <tr>
                                        <td>{{ skill }}</td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td>-</td>
                                    </tr>
                                {% endfor %}
                            </table>
                            <table id="languages" class="rpg-table">
                                <tr><th><h3>Languages</h3></th></tr>
                                {% for language in character.languages.all %}
                                    <tr>
                                        <td>{{ language.get_name_display }}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </td>
                        <td id="inventory">
                            <table class="rpg-table">
                                <tr><th><h3>Inventory</h3></th></tr>
                                <tr><th><h4>Armor</h4></th></tr>
                                {% for armor in inventory.armor_set.all %}
                                    <tr>
                                        <td>{{ armor }}</td>
                                    </tr>
                                {% endfor %}
                                <tr><th><h4>Weapons</h4></th></tr>
                                {% for weapon in inventory.weapon_set.all %}
                                    <tr>
                                        <td>{{ weapon }}</td>
                                    </tr>
                                {% endfor %}
                                <tr><th><h4>Pack</h4></th></tr>
                                {% for pack in inventory.pack_set.all %}
                                    <tr>
                                        <td>{{ pack }}</td>
                                    </tr>
                                {% endfor %}
                                <tr><th><h4>Gear</h4></th></tr>
                                {% for gear in inventory.gear_set.all %}
                                    <tr>
                                        <td>{{ gear }}</td>
                                    </tr>
                                {% endfor %}
                                <tr><th><h4>Tools</h4></th></tr>
                                {% for tool in inventory.tool_set.all %}
                                    <tr>
                                        <td>{{ tool }}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="rpg-section">
                <h3 class="panel-title" style="font-size: 1.3rem;">üé≤ Game</h3>
                {% with game=character.player.game %}
                    {% if game %}
                        <p>Ongoing game: <a href="{% url 'game' game.id %}" style="color: var(--color-primary); text-decoration: underline;">{{ game }}</a></p>
                    {% else %}
                        <p class="text-muted">This character is not part of any game...</p>
                    {% endif %}
                {% endwith%}
            </div>

        </div>
    </div>
{% endblock%}
