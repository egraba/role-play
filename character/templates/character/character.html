{% extends 'base.html' %}

{% block content %}
    <div class="rpg-container">
        <!-- Character Header -->
        <div class="rpg-panel" style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h1 class="panel-title" style="font-size: 2rem; margin-bottom: 5px;">‚öîÔ∏è {{ character }}</h1>
                    <div style="color: var(--color-text-muted);">
                        {{ character.get_race_display }} {{ character.get_klass_display }} ‚Ä¢ {{ character.get_alignment_display }}
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="color: var(--color-primary); font-size: 1.2rem;">Level {{ character.level }}</div>
                    <div style="color: var(--color-text-muted); font-size: 0.9rem;">{{ character.xp }} XP</div>
                </div>
            </div>
            <div style="margin-top: 15px;">
                <a href="{% url 'index' %}" class="rpg-btn btn-secondary" style="font-size: 0.9rem; padding: 8px 16px;">‚Üê Return to main menu</a>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="character-layout">
            <!-- Left Column: Vitals & Abilities -->
            <div class="character-column">
                <!-- HP Section -->
                <div class="rpg-panel" style="margin-bottom: 20px;">
                    <h3 class="panel-title" style="font-size: 1.2rem; margin-bottom: 15px;">‚ù§Ô∏è Vitals</h3>
                    <div class="stat-bar">
                        <div class="stat-label">
                            <span class="stat-label-name">HP</span>
                            <span>{{ character.hp }} / {{ character.max_hp }}</span>
                        </div>
                        <div class="stat-progress">
                            <div class="stat-fill health" style="width: {% widthratio character.hp character.max_hp 100 %}%"></div>
                        </div>
                    </div>
                    <div class="attribute-item" style="margin-top: 15px;">
                        <span class="attribute-name">Proficiency Bonus</span>
                        <span class="attribute-value">+{{ character.proficiency_bonus }}</span>
                    </div>
                </div>

                <!-- Abilities Section -->
                <div class="rpg-panel" style="margin-bottom: 20px;">
                    <h3 class="panel-title" style="font-size: 1.2rem; margin-bottom: 15px;">üí™ Abilities</h3>
                    <div class="attributes-grid">
                        {% for ability in abilities %}
                            <div class="attribute-item">
                                <span class="attribute-name">{{ ability }}</span>
                                <span class="attribute-value">{{ ability.score }} <span style="color: var(--color-text-muted); font-size: 0.85rem;">({{ ability.modifier }})</span></span>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Game Section -->
                <div class="rpg-panel">
                    <h3 class="panel-title" style="font-size: 1.2rem; margin-bottom: 15px;">üé≤ Game</h3>
                    {% with game=character.player.game %}
                        {% if game %}
                            <p>Ongoing game: <a href="{% url 'game' game.id %}" style="color: var(--color-primary); text-decoration: underline;">{{ game }}</a></p>
                        {% else %}
                            <p style="color: var(--color-text-muted);">This character is not part of any game...</p>
                        {% endif %}
                    {% endwith%}
                </div>
            </div>

            <!-- Middle Column: Skills & Languages -->
            <div class="character-column">
                <!-- Skills Section -->
                <div class="rpg-panel" style="margin-bottom: 20px;">
                    <h3 class="panel-title" style="font-size: 1.2rem; margin-bottom: 15px;">üéØ Skills</h3>
                    {% for skill in character.skills.all %}
                        <div class="attribute-item" style="margin-bottom: 8px;">
                            <span class="attribute-name">{{ skill }}</span>
                        </div>
                    {% empty %}
                        <p style="color: var(--color-text-muted);">No skills</p>
                    {% endfor %}
                </div>

                <!-- Languages Section -->
                <div class="rpg-panel">
                    <h3 class="panel-title" style="font-size: 1.2rem; margin-bottom: 15px;">üí¨ Languages</h3>
                    {% for language in character.languages.all %}
                        <div class="attribute-item" style="margin-bottom: 8px;">
                            <span class="attribute-name">{{ language.get_name_display }}</span>
                        </div>
                    {% empty %}
                        <p style="color: var(--color-text-muted);">No languages</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Right Column: Inventory -->
            <div class="character-column">
                <div class="rpg-panel">
                    <h3 class="panel-title" style="font-size: 1.2rem; margin-bottom: 15px;">üéí Inventory</h3>

                    {% if inventory.armor_set.all %}
                        <div style="margin-bottom: 15px;">
                            <h4 style="color: var(--color-primary); font-size: 1rem; margin-bottom: 8px;">üõ°Ô∏è Armor</h4>
                            {% for armor in inventory.armor_set.all %}
                                <div class="attribute-item" style="margin-bottom: 5px;">
                                    <span class="attribute-name">{{ armor }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if inventory.weapon_set.all %}
                        <div style="margin-bottom: 15px;">
                            <h4 style="color: var(--color-primary); font-size: 1rem; margin-bottom: 8px;">‚öîÔ∏è Weapons</h4>
                            {% for weapon in inventory.weapon_set.all %}
                                <div class="attribute-item" style="margin-bottom: 5px;">
                                    <span class="attribute-name">{{ weapon }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if inventory.pack_set.all %}
                        <div style="margin-bottom: 15px;">
                            <h4 style="color: var(--color-primary); font-size: 1rem; margin-bottom: 8px;">üéí Pack</h4>
                            {% for pack in inventory.pack_set.all %}
                                <div class="attribute-item" style="margin-bottom: 5px;">
                                    <span class="attribute-name">{{ pack }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if inventory.gear_set.all %}
                        <div style="margin-bottom: 15px;">
                            <h4 style="color: var(--color-primary); font-size: 1rem; margin-bottom: 8px;">‚öôÔ∏è Gear</h4>
                            {% for gear in inventory.gear_set.all %}
                                <div class="attribute-item" style="margin-bottom: 5px;">
                                    <span class="attribute-name">{{ gear }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if inventory.tool_set.all %}
                        <div style="margin-bottom: 15px;">
                            <h4 style="color: var(--color-primary); font-size: 1rem; margin-bottom: 8px;">üîß Tools</h4>
                            {% for tool in inventory.tool_set.all %}
                                <div class="attribute-item" style="margin-bottom: 5px;">
                                    <span class="attribute-name">{{ tool }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if not inventory.armor_set.all and not inventory.weapon_set.all and not inventory.pack_set.all and not inventory.gear_set.all and not inventory.tool_set.all %}
                        <p style="color: var(--color-text-muted);">Empty inventory</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <style>
        .character-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .character-column {
            display: flex;
            flex-direction: column;
        }

        @media (max-width: 1024px) {
            .character-layout {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .character-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
{% endblock%}
